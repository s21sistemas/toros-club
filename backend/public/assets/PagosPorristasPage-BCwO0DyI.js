import{o as Q,h as J,e as B,i as V,u as W,k as X,d as Z,f as aa,t as O,r as U,j as o}from"./index-CjWeqAa0.js";import{B as ea,a as oa}from"./ButtonsModal-C4PNvLzT.js";import{B as ta}from"./BaseTable-DxRxbJEJ.js";import{M as na}from"./ModalDelete-DpY_EDEH.js";import{u as T,a as G,I as m}from"./InputField-C2bV7C3J.js";import{A as q}from"./AlertaCard-CMccITvI.js";import{C as sa}from"./CancelButtonModal-BD6jH3B7.js";import{d as H}from"./dayjs.min-DH9acFiI.js";import{c as w}from"./caja-CQ-B0I8H.js";import{u as ra}from"./useCheerleaderStore-CBBE_m0w.js";import{u as la}from"./useTemporadasStore-BdbVkyd2.js";import{C as k}from"./CardAbonos-D4ODg-i3.js";import"./chevron-right-CCqFvTGw.js";import"./players-FXc4Iomq.js";import"./costos-porrista-9QLCd6eY.js";import"./es-Om7KOudh.js";import"./square-pen-BYxR8_4Y.js";import"./eye-BbsgsaIk.js";import"./categorias-DYCwzMem.js";import"./historial-DbYVCKzn.js";import"./calendar-A_TMcF9S.js";const K=Z(B,"pagos_porristas"),ca=async r=>{try{const e=H(),a={...r,porristaId:r.porrista.value,nombre:r.porrista.label,fecha_registro:e.format("YYYY-MM-DD")};return delete a.porrista,(await X(K,a)).id}catch(e){console.error("Error al agregar pago:",e)}},ia=async r=>Q(K,e=>{const a=e.docs.map(t=>{var u,c;const s=t.data(),d=s.pagos||[];return{id:t.id,porrista:{value:s.porristaId,label:s.nombre},inscripcion:(u=d.find(g=>g.tipo==="Inscripción"))==null?void 0:u.estatus,coacheo:(c=d.find(g=>g.tipo==="Coaching"))==null?void 0:c.estatus,...t.data()}});r(a)}),da=async(r,e)=>{try{const a=e.pagos.find(c=>c.tipo==="Inscripción"),t=e.pagos.find(c=>c.tipo==="Coaching");if(a.abono==="SI"){Array.isArray(a.abonos)||(a.abonos=[]),a.abonos.push({cantidad:e.cantidad_abono_ins,fecha:e.fecha_abono_ins,metodo:e.metodo_pago_abono_ins}),a.total_abonado=parseFloat(e.cantidad_abono_ins)+parseFloat(a.total_abonado||0),a.abono="NO";const c={jugadorId:e.jugadorId,nombre:e.nombre,tabla:"Jugador",concepto:"Pago de inscripción (abono)",fecha_pago:e.fecha_abono_ins||d,total:e.cantidad_abono_ins||0,metodo_pago:e.metodo_pago_abono_ins||null};await w(c)}if(t.abono==="SI"){Array.isArray(t.abonos)||(t.abonos=[]),t.abonos.push({cantidad:e.cantidad_abono_coach,fecha:e.fecha_abono_coach,metodo:e.metodo_pago_abono_coach}),t.total_abonado=parseFloat(e.cantidad_abono_coach)+parseFloat(t.total_abonado||0),t.abono="NO";const c={jugadorId:e.jugadorId,nombre:e.nombre,tabla:"Jugador",concepto:"Pago de coach (abono)",fecha_pago:e.fecha_abono_coach||d,total:e.cantidad_abono_coach||0,metodo_pago:e.metodo_pago_abono_coach||null};await w(c)}const s={...e,pagos:e.pagos.map(c=>({...c}))},d=H().format("YYYY-MM-DD");if(a==="pagado"){const c={jugadorId:s.porristaId,nombre:s.nombre,tabla:"Porrista",concepto:"Pago de inscripción",fecha_pago:a.fecha_pago||d,total:a.monto||0,metodo_pago:a.metodo_pago||null};await w(c)}if(t==="pagado"){const c={jugadorId:s.porristaId,nombre:s.nombre,tabla:"Porrista",concepto:"Pago de coaching semanal",fecha_pago:t.fecha_pago||d,total:t.monto||0,metodo_pago:t.metodo_pago||null};await w(c)}delete e.porrista,delete e.coacheo,delete e.inscripcion,delete e.cantidad_abono_ins,delete e.fecha_abono_ins,delete e.metodo_pago_abono_ins,delete e.cantidad_abono_coach,delete e.fecha_abono_coach,delete e.metodo_pago_abono_coach;const u=J(B,"pagos_porristas",r);await W(u,e)}catch(a){console.error("Error al actualizar pago:",a)}},pa=async r=>{try{const e=J(B,"pagos_porristas",r);await V(e)}catch(e){console.error("Error al eliminar pago:",e)}};let z=null;const I=aa((r,e)=>({payments:[],loading:!1,getDataPaymentsCheer:async()=>(r({loading:!0}),new Promise((a,t)=>{try{z?a(e().payments):z=ia(s=>{r({payments:s}),a(s)})}catch(s){console.error(s),t(s)}finally{r({loading:!1})}})),addPayment:async a=>{const t=async()=>{try{await ca(a)}catch(s){console.error(s)}};O.promise(t(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Falló al crear el registro."})},editPayment:async a=>{const t=async()=>{try{await da(a.id,a)}catch(s){console.error(s)}};O.promise(t(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Falló al eliminar."})},deletePayment:async a=>{const t=async()=>{try{await pa(a)}catch(s){console.error(s)}};O.promise(t(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Falló al eliminar."})}})),L=()=>{const r=la(n=>n.getDataTemporadas),e=T(n=>n.modalType),a=T(n=>n.formData),t=T(n=>n.setNestedFormData),s=T(n=>n.closeModal),d=I(n=>n.loading),u=I(n=>n.payments),c=I(n=>n.getDataPaymentsCheer),g=I(n=>n.addPayment),S=I(n=>n.editPayment),F=I(n=>n.deletePayment),D=ra(n=>n.getDataCheerleaders);return U.useEffect(()=>{var n,l,p,i,b,h,_,f,y,j,v,x,C,P,R,$;t("pagos.0.tipo","Inscripción"),t("pagos.1.tipo","Coaching"),(l=(n=a.pagos)==null?void 0:n[0])!=null&&l.estatus||t("pagos.0.estatus","pendiente"),(i=(p=a.pagos)==null?void 0:p[0])!=null&&i.fecha_pago||t("pagos.0.fecha_pago",null),(h=(b=a.pagos)==null?void 0:b[0])!=null&&h.fecha_pago||t("pagos.0.metodo_pago",null),(f=(_=a.pagos)==null?void 0:_[1])!=null&&f.estatus||t("pagos.1.estatus","pendiente"),(j=(y=a.pagos)==null?void 0:y[1])!=null&&j.fecha_pago||t("pagos.1.fecha_pago",null),(x=(v=a.pagos)==null?void 0:v[1])!=null&&x.fecha_pago||t("pagos.1.metodo_pago",null),(P=(C=a.pagos)==null?void 0:C[0])!=null&&P.total_abonado||t("pagos.0.total_abonado","0"),($=(R=a.pagos)==null?void 0:R[1])!=null&&$.total_abonado||t("pagos.1.total_abonado","0")},[a.pagos,t]),{payments:u,getDataPaymentsCheer:c,loading:d,handleSubmit:async n=>{n.preventDefault();try{e==="add"?await g(a):e==="edit"&&await S(a)}catch(l){console.log(l)}finally{s()}},handleDelete:async n=>{await F(n),s()},loadOptions:async()=>{try{return(await D()).map(l=>({value:l.id,label:`${l.nombre} ${l.apellido_p} ${l.apellido_m}`,temporada:l.temporadaId}))}catch(n){return console.error("Error loading users:",n),[]}},loadOptionsTemporadas:async()=>{try{return(await r()).map(l=>({value:l.id,label:l.temporada}))}catch(n){return console.error("Error loading data:",n),[]}}}},Y={inscriptionFields:[{required:!0,type:"select",label:"Estatus *",name:"estatus",opcSelect:[{value:"pendiente",label:"Pendiente"},{value:"pagado",label:"Pagado"}]},{required:!0,type:"number",label:"Monto total *",name:"monto"},{required:!1,type:"date",label:"Fecha de pago",name:"fecha_pago"},{required:!1,type:"select",label:"Método de pago (si no se ha pagado, dejar vacía)",name:"metodo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}]},{required:!1,type:"select",label:"¿Abonará? *",name:"abono",opcSelect:[{value:"NO",label:"No"},{value:"SI",label:"Sí"}]},{required:!1,type:"number",label:"Total abonado",name:"total_abonado"}],coachingFields:[{required:!0,type:"select",label:"Estatus *",name:"estatus",opcSelect:[{value:"pendiente",label:"Pendiente"},{value:"pagado",label:"Pagado"}]},{required:!0,type:"number",label:"Monto total *",name:"monto"},{required:!1,type:"date",label:"Fecha de pago",name:"fecha_pago"},{required:!1,type:"select",label:"Método de pago (si no se ha pagado, dejar vacía)",name:"metodo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}]},{required:!1,type:"select",label:"¿Abonará? *",name:"abono",opcSelect:[{value:"NO",label:"No"},{value:"SI",label:"Sí"}]},{required:!1,type:"number",label:"Total abonado",name:"total_abonado"}],paymentsFields:[{required:!1,type:"number",label:"Total pagado *",name:"monto_total_pagado"},{required:!1,type:"number",label:"Total pendiente *",name:"monto_total_pendiente"},{required:!0,type:"number",label:"Monto Total *",name:"monto_total"}]},ma=()=>{var c,g,S,F,D,M,E,N,A,n;const{view:r,document:e,formData:a,handleNestedInputChange:t,handleInputChange:s}=G(),{loadOptions:d,loadOptionsTemporadas:u}=L();return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[o.jsx(q,{text:"Jugador"}),o.jsx(m,{type:"async",label:"Selecciona la porrista",name:"porrista",required:!0,value:a.porrista||"",onChange:s,disabled:e?!0:r,loadOptions:d,classInput:"md:col-span-2"}),o.jsx(m,{type:"async",label:"Selecciona la temporada *",name:"temporadaId",required:!0,value:a.temporadaId,onChange:s,disabled:!0,loadOptions:u,classInput:"md:col-span-2"}),o.jsx(q,{text:"Pago de inscripción"}),Y.inscriptionFields.map(({type:l,label:p,name:i,required:b,opcSelect:h})=>{var _,f,y,j,v,x,C,P;return o.jsx(m,{type:l,label:p,required:((f=(_=a.pagos)==null?void 0:_[0])==null?void 0:f.estatus)==="pagado"?!0:b,opcSelect:h,name:`pagos.0.${i}`,value:((j=(y=a.pagos)==null?void 0:y[0])==null?void 0:j[i])??"",onChange:t,disabled:["total_abonado"].includes(i)||((x=(v=a.pagos)==null?void 0:v[0])==null?void 0:x.total_abonado)>=((P=(C=a.pagos)==null?void 0:C[0])==null?void 0:P.monto)&&i==="abono"?!0:r},i)}),((g=(c=a.pagos)==null?void 0:c[0])==null?void 0:g.abono)==="SI"&&o.jsxs(o.Fragment,{children:[o.jsx(m,{type:"number",label:"Cantidad abonada *",required:!0,name:"cantidad_abono_ins",value:a.cantidad_abono_ins??"",onChange:s,disabled:r}),o.jsx(m,{type:"date",label:"Fecha del abono *",required:!0,name:"fecha_abono_ins",value:a.fecha_abono_ins??"",onChange:s,disabled:r}),o.jsx(m,{type:"select",label:"Método de pago *",required:!0,name:"metodo_pago_abono_ins",value:a.metodo_pago_abono_ins??"",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],onChange:s,disabled:r})]}),((D=(F=(S=a.pagos)==null?void 0:S[0])==null?void 0:F.abonos)==null?void 0:D.length)>0&&o.jsxs(o.Fragment,{children:[o.jsx(q,{text:"Abonos de inscripción"}),a.pagos[0].abonos.map((l,p)=>o.jsxs(o.Fragment,{children:[o.jsx(k,{amount:l.cantidad,date:l.fecha,method:l.metodo},p),o.jsx("hr",{className:"sm:grid-cols-3 gap-2 md:col-span-2"})]}))]}),o.jsx(q,{text:"Pago de Coaching"}),Y.coachingFields.map(({type:l,label:p,name:i,required:b,opcSelect:h})=>{var _,f,y,j,v,x,C,P;return o.jsx(m,{type:l,label:p,required:((f=(_=a.pagos)==null?void 0:_[1])==null?void 0:f.estatus)==="pagado"?!0:b,opcSelect:h,name:`pagos.1.${i}`,value:((j=(y=a.pagos)==null?void 0:y[1])==null?void 0:j[i])??"",onChange:t,disabled:["total_abonado"].includes(i)||((x=(v=a.pagos)==null?void 0:v[1])==null?void 0:x.total_abonado)>=((P=(C=a.pagos)==null?void 0:C[1])==null?void 0:P.monto)&&i==="abono"?!0:r},i)}),((E=(M=a.pagos)==null?void 0:M[1])==null?void 0:E.abono)==="SI"&&o.jsxs(o.Fragment,{children:[o.jsx(m,{type:"number",label:"Cantidad abonada *",required:!0,name:"cantidad_abono_coach",value:a.cantidad_abono_coach??"",onChange:s,disabled:r}),o.jsx(m,{type:"date",label:"Fecha del abono *",required:!0,name:"fecha_abono_coach",value:a.fecha_abono_coach??"",onChange:s,disabled:r}),o.jsx(m,{type:"select",label:"Método de pago *",required:!0,name:"metodo_pago_abono_coach",value:a.metodo_pago_abono_coach??"",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],onChange:s,disabled:r})]}),((n=(A=(N=a.pagos)==null?void 0:N[1])==null?void 0:A.abonos)==null?void 0:n.length)>0&&o.jsxs(o.Fragment,{children:[o.jsx(q,{text:"Abonos de coaching"}),a.pagos[1].abonos.map((l,p)=>o.jsxs(o.Fragment,{children:[o.jsx(k,{amount:l.cantidad,date:l.fecha,method:l.metodo},p),o.jsx("hr",{className:"sm:grid-cols-3 gap-2 md:col-span-2"})]}))]}),o.jsx(q,{text:"Pagos"}),Y.paymentsFields.map(({type:l,label:p,name:i,required:b,opcSelect:h})=>o.jsx(m,{type:l,label:p,required:b,opcSelect:h,name:i,value:a[i]??"",onChange:t,disabled:r},i))]}),o.jsx("hr",{className:"text-gray-300"}),r?o.jsx(sa,{}):o.jsx(ea,{})]})},ua=[{key:"inscripcion",name:"Inscripción"},{key:"coacheo",name:"Coacheo"},{key:"nombre",name:"Porrista"}];function Aa(){const{modalType:r,currentItem:e}=G(),{payments:a,loading:t,getDataPaymentsCheer:s,handleSubmit:d,handleDelete:u}=L();return U.useEffect(()=>{(async()=>await s())()},[s]),o.jsxs("div",{className:"md:p-4 bg-gray-100",children:[o.jsx(ta,{columns:ua,data:a,title:"Pagos de porristas",loading:t}),(r==="add"||r==="edit"||r==="view")&&o.jsx(oa,{handleSubmit:d,Inputs:o.jsx(ma,{})}),r==="delete"&&e&&o.jsx(na,{handleDelete:u})]})}export{Aa as default};
