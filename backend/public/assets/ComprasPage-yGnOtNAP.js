import{f as q,t as v,j as a,r as D}from"./index-CjWeqAa0.js";import{B as F,a as B}from"./ButtonsModal-C4PNvLzT.js";import{B as O}from"./BaseTable-DxRxbJEJ.js";import{M as _}from"./ModalDelete-DpY_EDEH.js";import{x as A,u as h,a as C,I as i}from"./InputField-C2bV7C3J.js";import{u as P}from"./useProveedorStore-CovlzjRT.js";import{u as k}from"./useBankStore-C6DBwtaP.js";import{g as w,r as E,u as M,c as T}from"./compras-DiEO0baL.js";import{c as N}from"./schemas-BVPTICEC.js";import{C as R}from"./CancelButtonModal-BD6jH3B7.js";import{A as V}from"./AlertaCard-CMccITvI.js";import{u as z}from"./useReports-DexWxfc4.js";import"./dayjs.min-DH9acFiI.js";import"./chevron-right-CCqFvTGw.js";import"./players-FXc4Iomq.js";import"./costos-porrista-9QLCd6eY.js";import"./es-Om7KOudh.js";import"./square-pen-BYxR8_4Y.js";import"./eye-BbsgsaIk.js";import"./categorias-DYCwzMem.js";import"./useTemporadasStore-BdbVkyd2.js";let y=null;const g=q((s,n)=>({compras:[],loading:!1,getDataCompras:async()=>(s({loading:!0}),new Promise((r,t)=>{try{y?r(n().compras):y=w(o=>{s({compras:o}),r(o)})}catch(o){console.error(o),t(o)}finally{s({loading:!1})}})),addCompras:async r=>{const t=async()=>{try{await T(r)}catch(o){console.error(o)}};v.promise(t(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Falló al crear el registro."})},editCompras:async r=>{const t=async()=>{try{await M(r.id,r)}catch(o){console.error(o)}};v.promise(t(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Falló al eliminar."})},deleteCompras:async r=>{const t=async()=>{try{await E(r)}catch(o){console.error(o)}};v.promise(t(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Falló al eliminar."})}})),x=()=>{const s=P(e=>e.getDataProveedor),n=A(e=>e.getDataArticulo),r=k(e=>e.getDataBanks),t=h(e=>e.modalType),o=h(e=>e.formData),p=h(e=>e.closeModal),m=g(e=>e.loading),d=g(e=>e.compras),u=g(e=>e.getDataCompras),l=g(e=>e.addCompras),b=g(e=>e.editCompras),j=g(e=>e.deleteCompras);return{loadOptionsProveedores:async()=>{try{return(await s()).map(c=>({value:c.id,label:c.nombre}))}catch(e){return console.error("Error loading data:",e),[]}},loadOptionsArticulos:async()=>{try{return(await n()).map(c=>({value:c.id,label:c.nombre}))}catch(e){return console.error("Error loading data:",e),[]}},loadOptionsBancos:async()=>{try{return(await r()).map(c=>({value:c.id,label:c.nombre}))}catch(e){return console.error("Error loading data:",e),[]}},compras:d,loading:m,getDataCompras:u,handleSubmit:async e=>{e.preventDefault();const c=N.safeParse(o);if(!c.success){const I=c.error.flatten().fieldErrors,S=Object.values(I)[0][0];v.error(S);return}t==="add"?l(o):t==="edit"&&b(o),p()},handleDelete:e=>{j(e),p()}}},f={generalFields:[{required:!0,type:"async",label:"Selecciona al proveedor",name:"proveedorId"},{required:!0,type:"async",label:"Selecciona el articulo",name:"articuloId"},{required:!0,type:"async",label:"Selecciona el banco",name:"bancoId"},{required:!0,type:"number",label:"Cantidad de artículos",name:"cantidad_articulos"},{required:!0,type:"number",label:"Precio por artículo",name:"precio_articulo"},{required:!0,type:"text",label:"Concepto",name:"concepto"}],opcSelectMetodo:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],totalConIvaFields:[{required:!0,type:"number",label:"Subtotal",name:"subtotal"},{required:!0,type:"number",label:"Total (+IVA)",name:"total"}],totalSinIvaFields:[{required:!0,type:"number",label:"Total sin IVA",name:"total"}]},G=()=>{const{view:s,formData:n,handleInputChange:r,handleCheckboxChange:t}=C(),{loadOptionsProveedores:o,loadOptionsArticulos:p,loadOptionsBancos:m}=x();return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[a.jsx("div",{className:"sm:col-span-6 md:col-span-6 flex",children:a.jsx(i,{type:"checkbox",label:"¿Con IVA?",name:"iva",required:!1,value:n.iva||!1,onChange:t,disabled:s})}),f.generalFields.map(({type:d,label:u,name:l,required:b})=>a.jsx(i,{type:d,label:u,name:l,required:b,value:n[l]||"",onChange:r,loadOptions:d==="async"?l==="proveedorId"?o:l==="articuloId"?p:m:()=>{},disabled:["precio_articulo"].includes(l)?!0:s,classInput:"md:col-span-3"},l)),a.jsx(i,{type:"select",label:"Método de pago",name:"metodo_pago",required:!0,value:n.metodo_pago||"",onChange:r,disabled:s,classInput:"md:col-span-3",opcSelect:f.opcSelectMetodo}),n.iva?f.totalConIvaFields.map(({type:d,label:u,name:l,required:b})=>a.jsx(i,{type:d,label:u,name:l,required:b,value:n[l]||!1,onChange:r,disabled:["subtotal","total"].includes(l)?!0:s,classInput:"md:col-span-3"},l)):f.totalSinIvaFields.map(({type:d,label:u,name:l,required:b})=>a.jsx(i,{type:d,label:u,name:l,required:b,value:n[l]||!1,onChange:r,disabled:s,classInput:"md:col-span-3"},l))]}),s?a.jsx(R,{}):a.jsx(F,{})]})},H=()=>{const{generarReporteCompras:s,loadOptionsBancos:n,loadOptionsProveedor:r,handleInputChange:t,formReport:o}=z(),p=m=>{m.preventDefault(),s(o)};return a.jsxs("form",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 mt-3",onSubmit:p,children:[a.jsx(i,{label:"Fecha inicio",id:"fecha_inicio",name:"fecha_inicio",type:"date",required:!0,value:o.fecha_inicio,onChange:t,classInput:"md:col-span-3"}),a.jsx(i,{label:"Fecha fin",id:"fecha_fin",name:"fecha_fin",type:"date",required:!0,value:o.fecha_fin,onChange:t,classInput:"md:col-span-3"}),a.jsx(i,{label:"Bancos",id:"bancoId",name:"bancoId",type:"async",required:!0,value:o.bancoId,onChange:t,loadOptions:n,classInput:"md:col-span-3"}),a.jsx(i,{label:"Proveedor",id:"proveedorId",name:"proveedorId",type:"async",required:!0,value:o.proveedorId,onChange:t,loadOptions:r,classInput:"md:col-span-3"}),a.jsx(i,{label:"Selecciona el método de pago",id:"metodo_pago",name:"metodo_pago",type:"select",required:!0,value:o.metodo_pago,onChange:t,opcSelect:[{value:"",label:"Selecciona una opción"},{value:"todos",label:"Todos"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],classInput:"md:col-span-6"}),a.jsx("div",{className:"md:col-span-6 sm:col-span-6",children:a.jsx("button",{className:"rounded-sm text-white font-medium py-2 px-3 bg-[#3674B5] hover:bg-[#486483] transition-all cursor-pointer",children:"Generar reporte"})})]})},J=()=>a.jsxs("div",{className:"mt-6 bg-white p-4 rounded-xl mx-auto",children:[a.jsx(V,{text:"Generarador de reporte"}),a.jsx(H,{})]}),K=[{key:"proveedor",name:"Proveedor"},{key:"articulo",name:"Artículo"},{key:"total",name:"Total"},{key:"concepto",name:"Concepto"},{key:"metodo_pago",name:"Método de pago"},{key:"banco",name:"Banco"},{key:"fecha",name:"Fecha"}];function he(){const{modalType:s,currentItem:n}=C(),{compras:r,loading:t,getDataCompras:o,handleSubmit:p,handleDelete:m}=x();return D.useEffect(()=>{(async()=>await o())()},[o]),a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(O,{columns:K,data:r,title:"Compras de artículos",loading:t}),(s==="add"||s==="edit"||s==="view")&&a.jsx(B,{handleSubmit:p,Inputs:a.jsx(G,{})}),s==="delete"&&n&&a.jsx(_,{handleDelete:m}),a.jsx(J,{})]})}export{he as default};
