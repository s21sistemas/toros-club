import{o as H,h as Y,e as O,i as K,u as L,k as Q,d as V,f as W,t as N,r as z,j as o}from"./index-BBEn_SVL.js";import{B as X,a as Z}from"./ButtonsModal-DTPgTePp.js";import{B as aa}from"./BaseTable-D3Icrcxb.js";import{M as ea}from"./ModalDelete-Cm4UsPMz.js";import{u as D,a as J,I as g}from"./InputField-be6TBco1.js";import{A as q}from"./AlertaCard-Bu43UWrr.js";import{C as oa}from"./CancelButtonModal-C7JNYi4q.js";import{d as ta}from"./dayjs.min-8lXlmZD7.js";import{c as w}from"./caja-CIBvB7Yt.js";import{u as na}from"./useCheerleaderStore-8HTZhDUC.js";import{C as $}from"./CardAbonos-Df_3Fd0a.js";import"./chevron-right-AWaKUqHA.js";import"./players-Ctxd4Kou.js";import"./es-CF7lCWqw.js";import"./square-pen-BhYtd8da.js";import"./eye-C0bU4jNc.js";import"./categorias-Dc-bfLah.js";import"./historial-BrbO5SRO.js";import"./calendar-CDh-s6JL.js";const U=V(O,"pagos_porristas"),sa=async s=>{try{return(await Q(U,s)).id}catch(a){console.error("Error al agregar pago:",a)}},ra=async s=>H(U,a=>{const e=a.docs.map(t=>{var m,c;const r=t.data(),d=r.pagos||[];return{id:t.id,porrista:{value:r.porristaId,label:r.nombre},inscripcion:(m=d.find(u=>u.tipo==="Inscripción"))==null?void 0:m.estatus,coacheo:(c=d.find(u=>u.tipo==="Coaching"))==null?void 0:c.estatus,...t.data()}});s(e)}),la=async(s,a)=>{try{const e=a.pagos.find(c=>c.tipo==="Inscripción"),t=a.pagos.find(c=>c.tipo==="Coaching");if(e.abono==="SI"){Array.isArray(e.abonos)||(e.abonos=[]),e.abonos.push({cantidad:a.cantidad_abono_ins,fecha:a.fecha_abono_ins,metodo:a.metodo_pago_abono_ins}),e.total_abonado=parseFloat(a.cantidad_abono_ins)+parseFloat(e.total_abonado||0),e.abono="NO";const c={jugadorId:a.jugadorId,nombre:a.nombre,tabla:"Jugador",concepto:"Pago de inscripción (abono)",fecha_pago:a.fecha_abono_ins||d,total:a.cantidad_abono_ins||0,metodo_pago:a.metodo_pago_abono_ins||null};await w(c)}if(t.abono==="SI"){Array.isArray(t.abonos)||(t.abonos=[]),t.abonos.push({cantidad:a.cantidad_abono_coach,fecha:a.fecha_abono_coach,metodo:a.metodo_pago_abono_coach}),t.total_abonado=parseFloat(a.cantidad_abono_coach)+parseFloat(t.total_abonado||0),t.abono="NO";const c={jugadorId:a.jugadorId,nombre:a.nombre,tabla:"Jugador",concepto:"Pago de coach (abono)",fecha_pago:a.fecha_abono_coach||d,total:a.cantidad_abono_coach||0,metodo_pago:a.metodo_pago_abono_coach||null};await w(c)}const r={...a,pagos:a.pagos.map(c=>({...c}))},d=ta().format("YYYY-MM-DD");if(e==="pagado"){const c={jugadorId:r.porristaId,nombre:r.nombre,tabla:"Porrista",concepto:"Pago de inscripción",fecha_pago:e.fecha_pago||d,total:e.monto||0,metodo_pago:e.metodo_pago||null};await w(c)}if(t==="pagado"){const c={jugadorId:r.porristaId,nombre:r.nombre,tabla:"Porrista",concepto:"Pago de coaching semanal",fecha_pago:t.fecha_pago||d,total:t.monto||0,metodo_pago:t.metodo_pago||null};await w(c)}delete a.porrista,delete a.coacheo,delete a.inscripcion,delete a.cantidad_abono_ins,delete a.fecha_abono_ins,delete a.metodo_pago_abono_ins,delete a.cantidad_abono_coach,delete a.fecha_abono_coach,delete a.metodo_pago_abono_coach;const m=Y(O,"pagos_porristas",s);await L(m,a)}catch(e){console.error("Error al actualizar pago:",e)}},ca=async s=>{try{const a=Y(O,"pagos_porristas",s);await K(a)}catch(a){console.error("Error al eliminar pago:",a)}};let k=null;const F=W((s,a)=>({payments:[],loading:!1,getDataPaymentsCheer:async()=>(s({loading:!0}),new Promise((e,t)=>{try{k?e(a().payments):k=ra(r=>{s({payments:r}),e(r)})}catch(r){console.error(r),t(r)}finally{s({loading:!1})}})),addPayment:async e=>{const t=async()=>{try{await sa(e)}catch(r){console.error(r)}};N.promise(t(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Falló al crear el registro."})},editPayment:async e=>{const t=async()=>{try{await la(e.id,e)}catch(r){console.error(r)}};N.promise(t(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Falló al eliminar."})},deletePayment:async e=>{const t=async()=>{try{await ca(e)}catch(r){console.error(r)}};N.promise(t(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Falló al eliminar."})}})),G=()=>{const s=D(n=>n.modalType),a=D(n=>n.formData),e=D(n=>n.setNestedFormData),t=D(n=>n.closeModal),r=F(n=>n.loading),d=F(n=>n.payments),m=F(n=>n.getDataPaymentsCheer),c=F(n=>n.addPayment),u=F(n=>n.editPayment),S=F(n=>n.deletePayment),I=na(n=>n.getDataCheerleaders);return z.useEffect(()=>{var n,l,p,i,b,h,_,f,y,j,v,x,C,P,B,R;e("pagos.0.tipo","Inscripción"),e("pagos.1.tipo","Coaching"),(l=(n=a.pagos)==null?void 0:n[0])!=null&&l.estatus||e("pagos.0.estatus","pendiente"),(i=(p=a.pagos)==null?void 0:p[0])!=null&&i.fecha_pago||e("pagos.0.fecha_pago",null),(h=(b=a.pagos)==null?void 0:b[0])!=null&&h.fecha_pago||e("pagos.0.metodo_pago",null),(f=(_=a.pagos)==null?void 0:_[1])!=null&&f.estatus||e("pagos.1.estatus","pendiente"),(j=(y=a.pagos)==null?void 0:y[1])!=null&&j.fecha_pago||e("pagos.1.fecha_pago",null),(x=(v=a.pagos)==null?void 0:v[1])!=null&&x.fecha_pago||e("pagos.1.metodo_pago",null),(P=(C=a.pagos)==null?void 0:C[0])!=null&&P.total_abonado||e("pagos.0.total_abonado","0"),(R=(B=a.pagos)==null?void 0:B[1])!=null&&R.total_abonado||e("pagos.1.total_abonado","0")},[a.pagos,e]),{payments:d,getDataPaymentsCheer:m,loading:r,handleSubmit:async n=>{n.preventDefault();try{s==="add"?await c(a):s==="edit"&&await u(a)}catch(l){console.log(l)}finally{t()}},handleDelete:async n=>{await S(n),t()},loadOptions:async()=>{try{return(await I()).map(l=>({value:l.id,label:`${l.nombre} ${l.apellido_p} ${l.apellido_m}`}))}catch(n){return console.error("Error loading users:",n),[]}}}},A={inscriptionFields:[{required:!0,type:"select",label:"Estatus *",name:"estatus",opcSelect:[{value:"pendiente",label:"Pendiente"},{value:"pagado",label:"Pagado"}]},{required:!0,type:"number",label:"Monto total *",name:"monto"},{required:!1,type:"date",label:"Fecha de pago",name:"fecha_pago"},{required:!1,type:"select",label:"Método de pago (si no se ha pagado, dejar vacía)",name:"metodo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}]},{required:!1,type:"select",label:"¿Abonará? *",name:"abono",opcSelect:[{value:"NO",label:"No"},{value:"SI",label:"Sí"}]},{required:!1,type:"number",label:"Total abonado",name:"total_abonado"}],coachingFields:[{required:!0,type:"select",label:"Estatus *",name:"estatus",opcSelect:[{value:"pendiente",label:"Pendiente"},{value:"pagado",label:"Pagado"}]},{required:!0,type:"number",label:"Monto total *",name:"monto"},{required:!1,type:"date",label:"Fecha de pago",name:"fecha_pago"},{required:!1,type:"select",label:"Método de pago (si no se ha pagado, dejar vacía)",name:"metodo_pago",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}]},{required:!1,type:"select",label:"¿Abonará? *",name:"abono",opcSelect:[{value:"NO",label:"No"},{value:"SI",label:"Sí"}]},{required:!1,type:"number",label:"Total abonado",name:"total_abonado"}],paymentsFields:[{required:!1,type:"number",label:"Total pagado *",name:"monto_total_pagado"},{required:!1,type:"number",label:"Total pendiente *",name:"monto_total_pendiente"},{required:!0,type:"number",label:"Monto Total *",name:"monto_total"}]},ia=()=>{var d,m,c,u,S,I,E,M,T,n;const{view:s,formData:a,handleNestedInputChange:e,handleInputChange:t}=J(),{loadOptions:r}=G();return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[o.jsx(q,{text:"Jugador"}),o.jsx(g,{type:"async",label:"Selecciona la porrista",name:"porrista",required:!0,value:a.porrista||"",onChange:t,disabled:!0,loadOptions:r,classInput:"md:col-span-2"}),o.jsx(q,{text:"Pago de inscripción"}),A.inscriptionFields.map(({type:l,label:p,name:i,required:b,opcSelect:h})=>{var _,f,y,j,v,x,C,P;return o.jsx(g,{type:l,label:p,required:((f=(_=a.pagos)==null?void 0:_[0])==null?void 0:f.estatus)==="pagado"?!0:b,opcSelect:h,name:`pagos.0.${i}`,value:((j=(y=a.pagos)==null?void 0:y[0])==null?void 0:j[i])??"",onChange:e,disabled:["monto","total_abonado"].includes(i)||((x=(v=a.pagos)==null?void 0:v[0])==null?void 0:x.total_abonado)>=((P=(C=a.pagos)==null?void 0:C[0])==null?void 0:P.monto)&&i==="abono"?!0:s},i)}),((m=(d=a.pagos)==null?void 0:d[0])==null?void 0:m.abono)==="SI"&&o.jsxs(o.Fragment,{children:[o.jsx(g,{type:"number",label:"Cantidad abonada *",required:!0,name:"cantidad_abono_ins",value:a.cantidad_abono_ins??"",onChange:t,disabled:s}),o.jsx(g,{type:"date",label:"Fecha del abono *",required:!0,name:"fecha_abono_ins",value:a.fecha_abono_ins??"",onChange:t,disabled:s}),o.jsx(g,{type:"select",label:"Método de pago *",required:!0,name:"metodo_pago_abono_ins",value:a.metodo_pago_abono_ins??"",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],onChange:t,disabled:s})]}),((S=(u=(c=a.pagos)==null?void 0:c[0])==null?void 0:u.abonos)==null?void 0:S.length)>0&&o.jsxs(o.Fragment,{children:[o.jsx(q,{text:"Abonos de inscripción"}),a.pagos[0].abonos.map((l,p)=>o.jsxs(o.Fragment,{children:[o.jsx($,{amount:l.cantidad,date:l.fecha,method:l.metodo},p),o.jsx("hr",{className:"sm:grid-cols-3 gap-2 md:col-span-2"})]}))]}),o.jsx(q,{text:"Pago de Coaching"}),A.coachingFields.map(({type:l,label:p,name:i,required:b,opcSelect:h})=>{var _,f,y,j,v,x,C,P;return o.jsx(g,{type:l,label:p,required:((f=(_=a.pagos)==null?void 0:_[1])==null?void 0:f.estatus)==="pagado"?!0:b,opcSelect:h,name:`pagos.1.${i}`,value:((j=(y=a.pagos)==null?void 0:y[1])==null?void 0:j[i])??"",onChange:e,disabled:["monto","total_abonado"].includes(i)||((x=(v=a.pagos)==null?void 0:v[1])==null?void 0:x.total_abonado)>=((P=(C=a.pagos)==null?void 0:C[1])==null?void 0:P.monto)&&i==="abono"?!0:s},i)}),((E=(I=a.pagos)==null?void 0:I[1])==null?void 0:E.abono)==="SI"&&o.jsxs(o.Fragment,{children:[o.jsx(g,{type:"number",label:"Cantidad abonada *",required:!0,name:"cantidad_abono_coach",value:a.cantidad_abono_coach??"",onChange:t,disabled:s}),o.jsx(g,{type:"date",label:"Fecha del abono *",required:!0,name:"fecha_abono_coach",value:a.fecha_abono_coach??"",onChange:t,disabled:s}),o.jsx(g,{type:"select",label:"Método de pago *",required:!0,name:"metodo_pago_abono_coach",value:a.metodo_pago_abono_coach??"",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],onChange:t,disabled:s})]}),((n=(T=(M=a.pagos)==null?void 0:M[1])==null?void 0:T.abonos)==null?void 0:n.length)>0&&o.jsxs(o.Fragment,{children:[o.jsx(q,{text:"Abonos de coaching"}),a.pagos[1].abonos.map((l,p)=>o.jsxs(o.Fragment,{children:[o.jsx($,{amount:l.cantidad,date:l.fecha,method:l.metodo},p),o.jsx("hr",{className:"sm:grid-cols-3 gap-2 md:col-span-2"})]}))]}),o.jsx(q,{text:"Pagos"}),A.paymentsFields.map(({type:l,label:p,name:i,required:b,opcSelect:h})=>o.jsx(g,{type:l,label:p,required:b,opcSelect:h,name:i,value:a[i]??"",onChange:e,disabled:s},i))]}),o.jsx("hr",{className:"text-gray-300"}),s?o.jsx(oa,{}):o.jsx(X,{})]})},da=[{key:"inscripcion",name:"Inscripción"},{key:"coacheo",name:"Coacheo"},{key:"nombre",name:"Porrista"}];function wa(){const{modalType:s,currentItem:a}=J(),{payments:e,loading:t,getDataPaymentsCheer:r,handleSubmit:d,handleDelete:m}=G();return z.useEffect(()=>{(async()=>await r())()},[r]),o.jsxs("div",{className:"md:p-4 bg-gray-100",children:[o.jsx(aa,{columns:da,data:e,title:"Pagos de porristas",loading:t}),(s==="add"||s==="edit"||s==="view")&&o.jsx(Z,{handleSubmit:d,Inputs:o.jsx(ia,{})}),s==="delete"&&a&&o.jsx(ea,{handleDelete:m})]})}export{wa as default};
