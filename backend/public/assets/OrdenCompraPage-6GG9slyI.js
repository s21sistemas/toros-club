import{o as F,h as x,e as C,i as B,u as P,T as q,k as A,d as E,f as k,t as f,j as n,r as _}from"./index-CjWeqAa0.js";import{B as R,a as M}from"./ButtonsModal-C4PNvLzT.js";import{B as T}from"./BaseTable-DxRxbJEJ.js";import{M as N}from"./ModalDelete-DpY_EDEH.js";import{x as Y,u as h,a as I,I as p}from"./InputField-C2bV7C3J.js";import{u as z}from"./useProveedorStore-CovlzjRT.js";import{d as V}from"./dayjs.min-DH9acFiI.js";import{u as G}from"./useBankStore-C6DBwtaP.js";import{o as H}from"./schemas-BVPTICEC.js";import{C as J}from"./CancelButtonModal-BD6jH3B7.js";import{A as K}from"./AlertaCard-CMccITvI.js";import{u as L}from"./useReports-DexWxfc4.js";import"./chevron-right-CCqFvTGw.js";import"./players-FXc4Iomq.js";import"./costos-porrista-9QLCd6eY.js";import"./es-Om7KOudh.js";import"./square-pen-BYxR8_4Y.js";import"./eye-BbsgsaIk.js";import"./categorias-DYCwzMem.js";import"./useTemporadasStore-BdbVkyd2.js";const j=E(C,"ordenes_compra"),Q=async o=>{try{return o.estatus="pendiente",o.fecha=q.now(),(await A(j,o)).id}catch(t){console.error("Error al agregar orden de compra:",t)}},U=async o=>F(j,t=>{const r=t.docs.map(s=>{const a=s.data();return{id:s.id,...s.data(),proveedor:a.proveedorId.label,articulo:a.articuloId.label,banco:a.bancoId.label,fecha:V.unix(s.data().fecha.seconds).format("DD/MM/YYYY")}});o(r)}),W=async(o,t)=>{try{delete t.proveedor,delete t.articulo,delete t.banco,delete t.fecha;const r=x(C,"ordenes_compra",o);await P(r,t)}catch(r){console.error("Error al actualizar orden de compra:",r)}},X=async o=>{try{const t=x(C,"ordenes_compra",o);await B(t)}catch(t){console.error("Error al eliminar orden de compra:",t)}};let O=null;const b=k((o,t)=>({ordenCompras:[],loading:!1,getDataOrdenCompras:async()=>(o({loading:!0}),new Promise((r,s)=>{try{O?r(t().ordenCompras):O=U(a=>{o({ordenCompras:a}),r(a)})}catch(a){console.error(a),s(a)}finally{o({loading:!1})}})),addOrdenCompra:async r=>{const s=async()=>{try{await Q(r)}catch(a){console.error(a)}};f.promise(s(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Falló al crear el registro."})},editOrdenCompra:async r=>{const s=async()=>{try{await W(r.id,r)}catch(a){console.error(a)}};f.promise(s(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Falló al eliminar."})},deleteOrdenCompra:async r=>{const s=async()=>{try{await X(r)}catch(a){console.error(a)}};f.promise(s(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Falló al eliminar."})}})),D=()=>{const o=z(e=>e.getDataProveedor),t=Y(e=>e.getDataArticulo),r=G(e=>e.getDataBanks),s=h(e=>e.modalType),a=h(e=>e.formData),c=h(e=>e.closeModal),m=b(e=>e.loading),i=b(e=>e.ordenCompras),u=b(e=>e.getDataOrdenCompras),l=b(e=>e.addOrdenCompra),g=b(e=>e.editOrdenCompra),S=b(e=>e.deleteOrdenCompra);return{loadOptionsProveedores:async()=>{try{return(await o()).map(d=>({value:d.id,label:d.nombre}))}catch(e){return console.error("Error loading data:",e),[]}},loadOptionsArticulos:async()=>{try{return(await t()).map(d=>({value:d.id,label:d.nombre}))}catch(e){return console.error("Error loading data:",e),[]}},loadOptionsBancos:async()=>{try{return(await r()).map(d=>({value:d.id,label:d.nombre}))}catch(e){return console.error("Error loading data:",e),[]}},ordenCompras:i,loading:m,getDataOrdenCompras:u,handleSubmit:async e=>{e.preventDefault();const d=H.safeParse(a);if(!d.success){const v=d.error.flatten().fieldErrors;console.log(v);const w=Object.values(v)[0][0];f.error(w);return}s==="add"?l(a):s==="edit"&&g(a),c()},handleDelete:e=>{S(e),c()}}},y={generalFields:[{required:!0,type:"async",label:"Selecciona al proveedor",name:"proveedorId"},{required:!0,type:"async",label:"Selecciona el banco",name:"bancoId"},{required:!0,type:"async",label:"Selecciona el articulo",name:"articuloId"},{required:!0,type:"number",label:"Cantidad de artículos",name:"cantidad_articulos"},{required:!0,type:"number",label:"Precio por artículo",name:"precio_articulo"}],totalConIvaFields:[{required:!0,type:"number",label:"Subtotal",name:"subtotal"},{required:!0,type:"number",label:"Total (+IVA)",name:"total"}],totalSinIvaFields:[{required:!0,type:"number",label:"Total sin IVA",name:"total"}]},Z=()=>{const{view:o,formData:t,handleInputChange:r,handleCheckboxChange:s}=I(),{loadOptionsProveedores:a,loadOptionsArticulos:c,loadOptionsBancos:m}=D();return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[n.jsx("div",{className:"sm:col-span-6 md:col-span-6 flex",children:n.jsx(p,{type:"checkbox",label:"¿Con IVA?",name:"iva",required:!1,value:t.iva||!1,onChange:s,disabled:o})}),y.generalFields.map(({type:i,label:u,name:l,required:g})=>n.jsx(p,{type:i,label:u,name:l,required:g,value:t[l]||"",onChange:r,loadOptions:i==="async"?l==="proveedorId"?a:l==="articuloId"?c:m:()=>{},disabled:l==="precio_articulo"?!0:o,classInput:"md:col-span-3"},l)),t.iva?y.totalConIvaFields.map(({type:i,label:u,name:l,required:g})=>n.jsx(p,{type:i,label:u,name:l,required:g,value:t[l]||!1,onChange:r,disabled:o,classInput:"md:col-span-3"},l)):y.totalSinIvaFields.map(({type:i,label:u,name:l,required:g})=>n.jsx(p,{type:i,label:u,name:l,required:g,value:t[l]||!1,onChange:r,disabled:o,classInput:"md:col-span-3"},l))]}),o?n.jsx(J,{}):n.jsx(R,{})]})},$=()=>{const{generarReporteOrdenes:o,loadOptionsBancos:t,handleInputChange:r,loadOptionsProveedor:s,formReport:a}=L(),c=m=>{m.preventDefault(),o(a)};return n.jsxs("form",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 mt-3",onSubmit:c,children:[n.jsx(p,{label:"Fecha inicio",id:"fecha_inicio",name:"fecha_inicio",type:"date",required:!0,value:a.fecha_inicio,onChange:r,classInput:"md:col-span-3"}),n.jsx(p,{label:"Fecha fin",id:"fecha_fin",name:"fecha_fin",type:"date",required:!0,value:a.fecha_fin,onChange:r,classInput:"md:col-span-3"}),n.jsx(p,{label:"Bancos",id:"bancoId",name:"bancoId",type:"async",required:!0,value:a.bancoId,onChange:r,loadOptions:t,classInput:"md:col-span-3"}),n.jsx(p,{label:"Proveedor",id:"proveedorId",name:"proveedorId",type:"async",required:!0,value:a.proveedorId,onChange:r,loadOptions:s,classInput:"md:col-span-3"}),n.jsx(p,{label:"Selecciona el estatus",id:"estatus",name:"estatus",type:"select",required:!0,value:a.estatus,onChange:r,opcSelect:[{value:"",label:"Selecciona una opción"},{value:"todos",label:"Todos"},{value:"pendiente",label:"Pendiente"},{value:"pagada",label:"Pagada"},{value:"cancelada",label:"Cancelada"}],classInput:"md:col-span-3"}),n.jsx("div",{className:"md:col-span-6 sm:col-span-6",children:n.jsx("button",{className:"rounded-sm text-white font-medium py-2 px-3 bg-[#3674B5] hover:bg-[#486483] transition-all cursor-pointer",children:"Generar reporte"})})]})},ee=()=>n.jsxs("div",{className:"mt-6 bg-white p-4 rounded-xl mx-auto",children:[n.jsx(K,{text:"Generarador de reporte"}),n.jsx($,{})]}),ae=[{key:"proveedor",name:"Proveedor"},{key:"banco",name:"Banco"},{key:"articulo",name:"Artículo"},{key:"cantidad_articulos",name:"Cantidad"},{key:"total",name:"Total"},{key:"estatus",name:"Estatus"},{key:"fecha",name:"Fecha de orden"}];function we(){const{modalType:o,currentItem:t}=I(),{ordenCompras:r,loading:s,getDataOrdenCompras:a,handleSubmit:c,handleDelete:m}=D();return _.useEffect(()=>{(async()=>await a())()},[a]),n.jsxs("div",{className:"md:p-4 bg-gray-100",children:[n.jsx(T,{columns:ae,data:r,title:"Ordenes de compra",loading:s}),(o==="add"||o==="edit"||o==="view")&&n.jsx(M,{handleSubmit:c,Inputs:n.jsx(Z,{})}),o==="delete"&&t&&n.jsx(N,{handleDelete:m}),n.jsx(ee,{})]})}export{we as default};
