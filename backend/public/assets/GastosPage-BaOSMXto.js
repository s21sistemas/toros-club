import{o as w,h as j,e as v,i as B,u as q,T as E,k as M,d as O,f as T,t as h,j as s,r as A}from"./index-CjWeqAa0.js";import{B as _,a as k}from"./ButtonsModal-C4PNvLzT.js";import{B as R}from"./BaseTable-DxRxbJEJ.js";import{M as P}from"./ModalDelete-DpY_EDEH.js";import{x as N,u as y,a as G,I as d}from"./InputField-C2bV7C3J.js";import{u as Y}from"./useProveedorStore-CovlzjRT.js";import{u as z}from"./useBankStore-C6DBwtaP.js";import{d as V}from"./dayjs.min-DH9acFiI.js";import{g as X}from"./schemas-BVPTICEC.js";import{C as H}from"./CancelButtonModal-BD6jH3B7.js";import{A as J}from"./AlertaCard-CMccITvI.js";import{u as K}from"./useReports-DexWxfc4.js";import"./chevron-right-CCqFvTGw.js";import"./players-FXc4Iomq.js";import"./costos-porrista-9QLCd6eY.js";import"./es-Om7KOudh.js";import"./square-pen-BYxR8_4Y.js";import"./eye-BbsgsaIk.js";import"./categorias-DYCwzMem.js";import"./useTemporadasStore-BdbVkyd2.js";const I=O(v,"gastos"),L=async o=>{try{return o.fecha=E.now(),(await M(I,o)).id}catch(t){console.error("Error al registrar gasto:",t)}},Q=async o=>w(I,t=>{const e=t.docs.map(r=>{var n;return{id:r.id,...r.data(),banco:(n=r.data())==null?void 0:n.bancoId.label,fecha:V.unix(r.data().fecha.seconds).format("DD/MM/YYYY")}});o(e)}),U=async(o,t)=>{try{delete t.banco,delete t.fecha;const e=j(v,"gastos",o);await q(e,t)}catch(e){console.error("Error al actualizar gasto:",e)}},W=async o=>{try{const t=j(v,"gastos",o);await B(t)}catch(t){console.error("Error al eliminar gasto:",t)}};let x=null;const g=T((o,t)=>({gastos:[],loading:!1,getDataGastos:async()=>(o({loading:!0}),new Promise((e,r)=>{try{x?e(t().gastos):x=Q(n=>{o({gastos:n}),e(n)})}catch(n){console.error(n),r(n)}finally{o({loading:!1})}})),addGastos:async e=>{const r=async()=>{try{await L(e)}catch(n){console.error(n)}};h.promise(r(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Falló al crear el registro."})},editGastos:async e=>{const r=async()=>{try{await U(e.id,e)}catch(n){console.error(n)}};h.promise(r(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Falló al eliminar."})},deleteGastos:async e=>{const r=async()=>{try{await W(e)}catch(n){console.error(n)}};h.promise(r(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Falló al eliminar."})}})),C=()=>{const o=Y(a=>a.getDataProveedor),t=N(a=>a.getDataArticulo),e=z(a=>a.getDataBanks),r=y(a=>a.modalType),n=y(a=>a.formData),u=y(a=>a.closeModal),b=g(a=>a.loading),i=g(a=>a.gastos),m=g(a=>a.getDataGastos),l=g(a=>a.addGastos),p=g(a=>a.editGastos),D=g(a=>a.deleteGastos);return{loadOptionsProveedores:async()=>{try{return(await o()).map(c=>({value:c.id,label:c.nombre}))}catch(a){return console.error("Error loading data:",a),[]}},loadOptionsArticulos:async()=>{try{return(await t()).map(c=>({value:c.id,label:c.nombre}))}catch(a){return console.error("Error loading data:",a),[]}},loadOptionsBancos:async()=>{try{return(await e()).map(c=>({value:c.id,label:c.nombre}))}catch(a){return console.error("Error loading data:",a),[]}},gastos:i,loading:b,getDataGastos:m,handleSubmit:async a=>{a.preventDefault();const c=X.safeParse(n);if(!c.success){const S=c.error.flatten().fieldErrors,F=Object.values(S)[0][0];h.error(F);return}r==="add"?l(n):r==="edit"&&p(n),u()},handleDelete:a=>{D(a),u()}}},f={generalFields:[{required:!0,type:"async",label:"Selecciona el banco",name:"bancoId"},{required:!0,type:"text",label:"Concepto",name:"concepto"}],opcSelectMetodo:[{value:"",label:"Selecciona una opción"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],totalConIvaFields:[{required:!0,type:"number",label:"Subtotal",name:"subtotal"},{required:!0,type:"number",label:"Total (+IVA)",name:"total"}],totalSinIvaFields:[{required:!0,type:"number",label:"Total sin IVA",name:"total"}]},Z=()=>{const{view:o,formData:t,handleInputChange:e,handleCheckboxChange:r}=G(),{loadOptionsProveedores:n,loadOptionsArticulos:u,loadOptionsBancos:b}=C();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[s.jsx("div",{className:"sm:col-span-6 md:col-span-6 flex",children:s.jsx(d,{type:"checkbox",label:"¿Con IVA?",name:"iva",required:!1,value:t.iva||!1,onChange:r,disabled:o})}),f.generalFields.map(({type:i,label:m,name:l,required:p})=>s.jsx(d,{type:i,label:m,name:l,required:p,value:t[l]||"",onChange:e,loadOptions:i==="async"?l==="proveedorId"?n:l==="articuloId"?u:b:()=>{},disabled:o,classInput:"md:col-span-3"},l)),s.jsx(d,{type:"select",label:"Método de pago",name:"metodo_pago",required:!0,value:t.metodo_pago||"",onChange:e,disabled:o,classInput:"md:col-span-3",opcSelect:f.opcSelectMetodo}),t.iva?f.totalConIvaFields.map(({type:i,label:m,name:l,required:p})=>s.jsx(d,{type:i,label:m,name:l,required:p,value:t[l]||!1,onChange:e,disabled:["total"].includes(l)?!0:o,classInput:"md:col-span-3"},l)):f.totalSinIvaFields.map(({type:i,label:m,name:l,required:p})=>s.jsx(d,{type:i,label:m,name:l,required:p,value:t[l]||!1,onChange:e,disabled:o,classInput:"md:col-span-3"},l))]}),o?s.jsx(H,{}):s.jsx(_,{})]})},$=()=>{const{generarReporteGastos:o,loadOptionsBancos:t,handleInputChange:e,formReport:r}=K(),n=u=>{u.preventDefault(),o(r)};return s.jsxs("form",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 mt-3",onSubmit:n,children:[s.jsx(d,{label:"Fecha inicio",id:"fecha_inicio",name:"fecha_inicio",type:"date",required:!0,value:r.fecha_inicio,onChange:e,classInput:"md:col-span-3"}),s.jsx(d,{label:"Fecha fin",id:"fecha_fin",name:"fecha_fin",type:"date",required:!0,value:r.fecha_fin,onChange:e,classInput:"md:col-span-3"}),s.jsx(d,{label:"Bancos",id:"bancoId",name:"bancoId",type:"async",required:!0,value:r.bancoId,onChange:e,loadOptions:t,classInput:"md:col-span-3"}),s.jsx(d,{label:"Selecciona el método de pago",id:"metodo_pago",name:"metodo_pago",type:"select",required:!0,value:r.metodo_pago,onChange:e,opcSelect:[{value:"",label:"Selecciona una opción"},{value:"todos",label:"Todos"},{value:"transferencia bancaria",label:"Transferencia bancaria"},{value:"tarjeta",label:"Tarjeta de crédito/débito"},{value:"efectivo",label:"Efectivo"},{value:"cheques",label:" Cheques"}],classInput:"md:col-span-3"}),s.jsx("div",{className:"md:col-span-6 sm:col-span-6",children:s.jsx("button",{className:"rounded-sm text-white font-medium py-2 px-3 bg-[#3674B5] hover:bg-[#486483] transition-all cursor-pointer",children:"Generar reporte"})})]})},aa=()=>s.jsxs("div",{className:"mt-6 bg-white p-4 rounded-xl mx-auto",children:[s.jsx(J,{text:"Generarador de reporte"}),s.jsx($,{})]}),ea=[{key:"banco",name:"Banco"},{key:"concepto",name:"Concepto"},{key:"metodo_pago",name:"Método de pago"},{key:"total",name:"Total (MXN)"},{key:"fecha",name:"Fecha"}];function Fa(){const{modalType:o,currentItem:t}=G(),{gastos:e,loading:r,getDataGastos:n,handleSubmit:u,handleDelete:b}=C();return A.useEffect(()=>{(async()=>await n())()},[n]),s.jsxs("div",{className:"md:p-4 bg-gray-100",children:[s.jsx(R,{columns:ea,data:e,title:"Gastos",loading:r}),(o==="add"||o==="edit"||o==="view")&&s.jsx(k,{handleSubmit:u,Inputs:s.jsx(Z,{})}),o==="delete"&&t&&s.jsx(P,{handleDelete:b}),s.jsx(aa,{})]})}export{Fa as default};
