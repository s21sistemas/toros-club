import{r as U,t as E,j as a}from"./index-CjWeqAa0.js";import{B as G,a as J}from"./ButtonsModal-C4PNvLzT.js";import{B as z}from"./BaseTable-DxRxbJEJ.js";import{u as g,a as B,I as y}from"./InputField-C2bV7C3J.js";import{S as M}from"./sweetalert2.esm.all-B0Dix5B2.js";import{u as x}from"./usePlayerStore-BckgLlmE.js";import{u as H}from"./useUserStore-QG04tUN-.js";import{u as R}from"./uploadFile-BbNSwvBa.js";import{u as K}from"./useTemporadasStore-BdbVkyd2.js";import{j as V}from"./schemas-BVPTICEC.js";import{M as Y}from"./ModalDelete-DpY_EDEH.js";import{A as v}from"./AlertaCard-CMccITvI.js";import{C as Z}from"./CancelButtonModal-BD6jH3B7.js";import{S as Q}from"./SignatureInput-W-8Y7Lkn.js";import"./dayjs.min-DH9acFiI.js";import"./chevron-right-CCqFvTGw.js";import"./players-FXc4Iomq.js";import"./costos-porrista-9QLCd6eY.js";import"./es-Om7KOudh.js";import"./square-pen-BYxR8_4Y.js";import"./eye-BbsgsaIk.js";import"./categorias-DYCwzMem.js";import"./roles-BKNYmX0T.js";import"./index-Bh1Vj7TI.js";const L=o=>{const s=H(e=>e.getDataUsers),h=K(e=>e.getDataTemporadas),l=g(e=>e.modalType),r=g(e=>e.formData),m=g(e=>e.setFormData),p=g(e=>e.closeModal),d=g(e=>e.firma),D=g(e=>e.editFirma),S=x(e=>e.loading),_=x(e=>e.players),w=x(e=>e.getDataPlayers),C=x(e=>e.addPlayer),T=x(e=>e.editPlayer),N=x(e=>e.deletePlayer),[O,n]=U.useState(r.tipo_inscripcion||"");return{tipo:O,loadOptions:async()=>{try{return(await s()).map(c=>({value:c.uid,label:c.nombre_completo}))}catch(e){return console.error("Error loading users:",e),[]}},handleTipo:e=>{o(e),n(e.target.value)},players:_,loading:S,getDataPlayers:w,handleSubmit:async e=>{e.preventDefault();const c=V.safeParse(r);if(!c.success){const t=c.error.flatten().fieldErrors,P=Object.values(t)[0][0];E.error(P);return}let I=null;if(d===null&&l==="add"){E.warning("La firma es obligatoría.");return}else d===null&&l==="edit"?I=r.documentos.firma:d!==null&&(I=d);M.fire({title:'<h2 style="font-family: "sans-serif";">Guardando registro, por favor espere...</h2>',allowEscapeKey:!1,allowOutsideClick:!1,timerProgressBar:!0,didOpen:()=>{M.showLoading()}});try{const t={...r,curp:r.curp.toUpperCase(),uid:r.uid.value,activo:r.tipo_inscripcion==="reinscripcion"?"activo":"no activo",numero_mfl:r.numero_mfl?r.numero_mfl:"000000",documentos:{...r.documentos,firma:I}};if(t.documentos){const P=`jugadores/${t.uid}/documentos/${t.curp}`;for(const q in t.documentos){const k=t.documentos[q];if(k instanceof File){const $=await R(k,P);t.documentos[q]=$}}}if(t.foto&&t.foto instanceof File){const P=`jugadores/${t.uid}/fotos/${t.curp}`,q=await R(t.foto,P);t.foto=q}l==="add"?await C(t):l==="edit"&&await T(t)}catch(t){console.error("Ocurrio un error",t)}finally{M.close(),p(),D(null)}},handleDelete:e=>{N(e),p()},loadOptionsTemporadas:async()=>{try{return(await h()).map(c=>({value:c.id,label:c.temporada}))}catch(e){return console.error("Error loading data:",e),[]}},handleReglamento:()=>{m("acepta_reglamento",!0)}}},F={tipoInscripcion:[{value:"",label:"Selecciona una opción"},{value:"novato",label:"Novato"},{value:"transferencia",label:"Transferencia"},{value:"reinscripcion",label:"Reinscripción"}],reinscripcionOptions:[{value:"",label:"Selecciona una opción"},{value:"no activo",label:"No activo actualmente"},{value:"activo",label:"Reinscrito"}],transferenciaFields:[{required:!0,type:"text",label:"Club anterior",name:"club_anterior"},{required:!0,type:"text",label:"Temporadas jugadas",name:"temporadas_jugadas"},{required:!0,type:"select",label:"Mótivo de transferencia",name:"motivo_transferencia",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"Préstamo",label:"Préstamo"},{value:"Cambio de domicilio",label:"Cambio de domicilio"},{value:"Descanso",label:"Descanso"},{value:"Transferencia definitiva",label:"Transferencia definitiva"}]}],generalFields:[{required:!0,type:"text",label:"Nombre",name:"nombre"},{required:!0,type:"text",label:"Apellido paterno",name:"apellido_p"},{required:!0,type:"text",label:"Apellido materno",name:"apellido_m"},{required:!0,type:"select",label:"Sexo",name:"sexo",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"hombre",label:"Hombre"},{value:"mujer",label:"Mujer"}]},{required:!0,type:"text",label:"Dirección completa",name:"direccion"},{required:!0,type:"number",label:"Teléfono",name:"telefono"},{required:!0,type:"date",label:"Fecha de nacimiento",name:"fecha_nacimiento"},{required:!0,type:"text",label:"Lugar de nacimiento",name:"lugar_nacimiento"},{required:!0,type:"text",label:"CURP",name:"curp"},{required:!0,type:"select",label:"Grado escolar",name:"grado_escolar",opcSelect:[{value:"",label:"Selecciona una opción"},{value:"primaria",label:"Primaria"},{value:"secundaria",label:"Secundaria"},{value:"preparatoria",label:"Preparatoria"}]},{required:!0,type:"text",label:"Nombre de la escuela",name:"nombre_escuela"},{required:!0,type:"text",label:"Alergias",name:"alergias"},{required:!0,type:"text",label:"Padecimientos",name:"padecimientos"},{required:!0,type:"number",label:"Peso (kg)",name:"peso"},{required:!1,type:"number",label:"No. MFL (Puede dejarlo vacío y después editarlo)",name:"numero_mfl"},{required:!0,type:"select",label:"Categoría *",name:"categoria"},{required:!0,type:"async",label:"Tutor",name:"uid"},{required:!0,type:"file",label:"Foto del jugador",name:"foto",accept:"image/*"}],documentFields:[{required:!1,type:"file",label:"CURP del jugador (PDF)",name:"curp_jugador",accept:"application/pdf"},{required:!1,type:"file",label:"INE del tutor (PDF)",name:"ine_tutor",accept:"application/pdf"},{required:!1,type:"file",label:"Acta de nacimiento (PDF)",name:"acta_nacimiento",accept:"application/pdf"},{required:!1,type:"file",label:"Comprobante de domicilio (PDF)",name:"comprobante_domicilio",accept:"application/pdf"}]},A="/assets/reglamento_jugadores-BtY0eIzZ.pdf",W=()=>{const{view:o,document:s,edit:h,formData:l,handleInputChange:r,handleFileChange:m,categoriaOptions:p}=B(),{handleTipo:d,tipo:D,loadOptions:S,sigCanvas:_,clearSignature:w,saveSignature:C,loadOptionsTemporadas:T,handleReglamento:N}=L(r),O=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);return a.jsx(a.Fragment,{children:l.acepta_reglamento||s?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6 md:grid-cols-2 mb-7",children:[a.jsx(v,{text:"Temporada"}),a.jsx(y,{type:"async",label:"Selecciona la temporada *",name:"temporadaId",required:!0,value:l.temporadaId,onChange:r,disabled:o,loadOptions:T,classInput:"md:col-span-2"}),a.jsx(v,{text:"Tipo de inscripción"}),a.jsx(y,{type:"select",label:"Selecciona el tipo de inscripción *",name:"tipo_inscripcion",value:l.tipo_inscripcion,required:!0,onChange:d,disabled:o,opcSelect:F.tipoInscripcion,classInput:"md:col-span-2"}),D==="transferencia"&&a.jsxs(a.Fragment,{children:[a.jsx(v,{text:"Datos de transferencia"}),F.transferenciaFields.map(({type:n,label:f,name:i,required:b,opcSelect:u})=>{var j;return a.jsx(y,{type:n,label:f,required:b,opcSelect:u,name:`transferencia.${i}`,value:((j=l.transferencia)==null?void 0:j[i])||"",onChange:r,disabled:o},i)})]}),a.jsx(v,{text:"Datos generales"}),F.generalFields.map(({type:n,label:f,name:i,opcSelect:b,accept:u,required:j})=>a.jsx(y,{type:n,label:f,name:i,required:n==="file"&&s?!1:j,value:l[i]||"",onChange:n==="file"?m:r,disabled:o,opcSelect:i==="categoria"?p||[]:b,loadOptions:n==="async"?S:()=>{},accept:u,document:n==="file"&&s},i)),h&&a.jsx(a.Fragment,{children:a.jsx(y,{type:"select",label:"Activo (solo modificar si es reinscripción)",name:"activo",required:!1,opcSelect:F.reinscripcionOptions,value:l.activo||"",onChange:r,disabled:o})}),a.jsx(v,{text:"Documentos"}),F.documentFields.map(({type:n,label:f,name:i,accept:b})=>{var u;return a.jsx(y,{type:n,accept:b,label:f,required:!1,name:`documentos.${i}`,value:((u=l.documentos)==null?void 0:u[i])||"",onChange:m,disabled:o,document:s},i)}),a.jsx(v,{text:"Firma del tutor"}),a.jsx(Q,{view:o,formData:l,sigCanvas:_,clearSignature:w,saveSignature:C})]}),a.jsx("hr",{className:"text-gray-300"}),o?a.jsx(Z,{}):a.jsx(G,{})]}):O?a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"mb-4 text-gray-700 font-medium",children:"El visor no está disponible en móvil. Puedes abrir o descargar el reglamento aquí:"}),a.jsx("a",{href:A,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-all",download:!0,children:"Descargar reglamento"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-5 ",children:a.jsx("button",{onClick:N,type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:col-start-2 sm:text-sm cursor-pointer transition-all",children:"¿El padre, madre o tutor acepta el reglamento?"})}),a.jsx("div",{className:"w-full h-[100dvh]",children:a.jsx("iframe",{src:A,className:"w-full h-full border-none",title:"Visor PDF"})})]})})},X=[{key:"nombre_completo",name:"Nombre"},{key:"curp",name:"CURP"},{key:"numero_mfl",name:"MFL"},{key:"tipo_inscripcion",name:"Tipo de inscripción"},{key:"categoria",name:"Categoría"}],De=()=>{const{modalType:o,currentItem:s}=B(),{players:h,loading:l,getDataPlayers:r,handleSubmit:m,handleDelete:p}=L();return U.useEffect(()=>{(async()=>await r())()},[r]),a.jsxs("div",{className:"md:p-4 bg-gray-100",children:[a.jsx(z,{columns:X,data:h,title:"Jugadores",loading:l}),(o==="add"||o==="edit"||o==="view")&&a.jsx(J,{handleSubmit:m,Inputs:a.jsx(W,{})}),o==="delete"&&s&&a.jsx(Y,{handleDelete:p})]})};export{De as default};
