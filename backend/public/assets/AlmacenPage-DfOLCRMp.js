import{f as S,t as u,j as n,r as v}from"./index-BBEn_SVL.js";import{B as F,a as M}from"./ButtonsModal-DTPgTePp.js";import{B as k}from"./BaseTable-D3Icrcxb.js";import{M as E}from"./ModalDelete-Cm4UsPMz.js";import{u as p,x as w,a as A,I as g}from"./InputField-be6TBco1.js";import{g as C,a as I,u as B,c as T}from"./almacen-B8MojNVJ.js";import{d as O}from"./dayjs.min-8lXlmZD7.js";import{b as q}from"./schemas-BVPTICEC.js";import{C as Y}from"./CancelButtonModal-C7JNYi4q.js";import"./chevron-right-AWaKUqHA.js";import"./players-Ctxd4Kou.js";import"./es-CF7lCWqw.js";import"./square-pen-BhYtd8da.js";import"./eye-C0bU4jNc.js";import"./categorias-Dc-bfLah.js";let f=null;const s=S((o,l)=>({almacen:[],loading:!1,getDataAlmacen:async()=>(o({loading:!0}),new Promise((a,r)=>{try{f?a(l().almacen):f=C(t=>{o({almacen:t}),a(t)})}catch(t){console.error(t),r(t)}finally{o({loading:!1})}})),addAlmacen:async a=>{const r=async()=>{try{a.fecha=O().format("DD/MM/YYYY"),await T(a)}catch(t){console.error(t)}};u.promise(r(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Fall贸 al crear el registro."})},editAlmacen:async a=>{const r=async()=>{try{await B(a.id,a)}catch(t){console.error(t)}};u.promise(r(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Fall贸 al eliminar."})},deleteAlmacen:async a=>{const r=async()=>{try{await I(a)}catch(t){console.error(t)}};u.promise(r(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Fall贸 al eliminar."})}})),b=()=>{const o=p(e=>e.modalType),l=p(e=>e.formData),a=p(e=>e.closeModal),r=s(e=>e.loading),t=s(e=>e.almacen),i=s(e=>e.getDataAlmacen),c=s(e=>e.addAlmacen),d=s(e=>e.editAlmacen),h=s(e=>e.deleteAlmacen),x=w(e=>e.getDataArticulo);return{loadOptions:async()=>{try{return(await x()).map(m=>({value:m.id,label:m.nombre}))}catch(e){return console.error("Error loading articulos:",e),[]}},almacen:t,loading:r,getDataAlmacen:i,handleSubmit:e=>{e.preventDefault();const m=q.safeParse(l);if(!m.success){const D=m.error.flatten().fieldErrors,j=Object.values(D)[0][0];u.error(j);return}o==="add"?c(l):o==="edit"&&d(l),a()},handleDelete:e=>{h(e),a()}}},y={generalFields:[{required:!0,type:"async",label:"Selecciona el articulo",name:"articuloId"},{required:!0,type:"text",label:"Concepto",name:"concepto"},{required:!0,type:"number",label:"Stock",name:"stock"}],opcSelect:[{value:"",label:"Selecciona una opci贸n"},{value:"entrada",label:"Entrada"},{value:"salida",label:"Salida"}]},N=()=>{const{view:o,formData:l,handleInputChange:a}=A(),{loadOptions:r}=b();return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[y.generalFields.map(({type:t,label:i,name:c,required:d})=>n.jsx(g,{type:t,label:i,name:c,required:d,value:l[c]||"",onChange:a,disabled:o,classInput:"md:col-span-6",loadOptions:r},c)),n.jsx(g,{type:"select",label:"Tipo",name:"tipo",required:!0,value:l.tipo||"",onChange:a,disabled:o,classInput:"md:col-span-6",opcSelect:y.opcSelect})]}),o?n.jsx(Y,{}):n.jsx(F,{})]})},P=[{key:"articulo",name:"Nombre"},{key:"stock",name:"Stock"},{key:"tipo",name:"Tipo"},{key:"concepto",name:"Concepto"},{key:"fecha",name:"Fecha"}];function oe(){const{modalType:o,currentItem:l}=A(),{almacen:a,loading:r,getDataAlmacen:t,handleSubmit:i,handleDelete:c}=b();return v.useEffect(()=>{(async()=>await t())()},[t]),n.jsxs("div",{className:"md:p-4 bg-gray-100",children:[n.jsx(k,{columns:P,data:a,title:"Almacen",loading:r}),(o==="add"||o==="edit"||o==="view")&&n.jsx(M,{handleSubmit:i,Inputs:n.jsx(N,{})}),o==="delete"&&l&&n.jsx(E,{handleDelete:c})]})}export{oe as default};
