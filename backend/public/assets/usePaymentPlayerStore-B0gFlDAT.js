import{o as I,h,e as m,i as w,u as Y,k as q,d as D,f as F,t as u}from"./index-BBEn_SVL.js";import{d as b}from"./dayjs.min-8lXlmZD7.js";import{c as _}from"./caja-CIBvB7Yt.js";const y=D(m,"pagos_jugadores"),A=async d=>{try{return(await q(y,d)).id}catch(o){console.error("Error al agregar pago:",o)}},C=async d=>I(y,o=>{const a=o.docs.map(c=>{var r,i,l,g,p,e;const n=c.data(),t=n.pagos||[];return{id:c.id,jugador:{value:n.jugadorId,label:n.nombre},prorroga:(r=t.find(s=>s.tipo==="Inscripción"))==null?void 0:r.prorroga,fecha_limite:(i=t.find(s=>s.tipo==="Inscripción"))==null?void 0:i.fecha_limite,inscripcion:(l=t.find(s=>s.tipo==="Inscripción"))==null?void 0:l.estatus,tunel:(g=t.find(s=>s.tipo==="Túnel"))==null?void 0:g.estatus,botiquin:(p=t.find(s=>s.tipo==="Botiquín"))==null?void 0:p.estatus,coacheo:(e=t.find(s=>s.tipo==="Coaching"))==null?void 0:e.estatus,...c.data()}});d(a)}),M=async(d,o)=>{try{let a={...o};const c=o.pagos.findIndex(e=>e.tipo==="Coaching");if(c!==-1){const e=o.pagos[c],s=b(),j=e.fecha_pago?b(e.fecha_pago).add(1,"week").format("YYYY-MM-DD"):s.add(1,"week").format("YYYY-MM-DD"),P=e.fecha_pago?e.fecha_pago:s.format("YYYY-MM-DD");e.estatus==="pagado"&&(a.pagos[c]={...e,estatus:"pendiente",fecha_limite:j,fecha_pago:P})}const n=o.pagos.find(e=>e.tipo==="Inscripción"),t=o.pagos.find(e=>e.tipo==="Túnel"),r=o.pagos.find(e=>e.tipo==="Botiquín"),i=o.pagos.find(e=>e.tipo==="Coaching");if(n.abono==="SI"){Array.isArray(n.abonos)||(n.abonos=[]),n.abonos.push({cantidad:o.cantidad_abono_ins,fecha:o.fecha_abono_ins,metodo:o.metodo_pago_abono_ins}),n.total_abonado=parseFloat(o.cantidad_abono_ins)+parseFloat(n.total_abonado||0),n.abono="NO";const e={jugadorId:o.jugadorId,nombre:o.nombre,tabla:"Jugador",concepto:"Pago de inscripción (abono)",fecha_pago:o.fecha_abono_ins||g,total:o.cantidad_abono_ins||0,metodo_pago:o.metodo_pago_abono_ins||null};await _(e)}if(t.abono==="SI"){Array.isArray(t.abonos)||(t.abonos=[]),t.abonos.push({cantidad:o.cantidad_abono_tunel,fecha:o.fecha_abono_tunel,metodo:o.metodo_pago_abono_tunel}),t.total_abonado=parseFloat(o.cantidad_abono_tunel)+parseFloat(t.total_abonado||0),t.abono="NO";const e={jugadorId:o.jugadorId,nombre:o.nombre,tabla:"Jugador",concepto:"Pago de tunel (abono)",fecha_pago:o.fecha_abono_tunel||g,total:o.cantidad_abono_tunel||0,metodo_pago:o.metodo_pago_abono_tunel||null};await _(e)}if(r.abono==="SI"){Array.isArray(r.abonos)||(r.abonos=[]),r.abonos.push({cantidad:o.cantidad_abono_botiquin,fecha:o.fecha_abono_botiquin,metodo:o.metodo_pago_abono_botiquin}),r.total_abonado=parseFloat(o.cantidad_abono_botiquin)+parseFloat(r.total_abonado||0),r.abono="NO";const e={jugadorId:o.jugadorId,nombre:o.nombre,tabla:"Jugador",concepto:"Pago de botiquin (abono)",fecha_pago:o.fecha_abono_botiquin||g,total:o.cantidad_abono_botiquin||0,metodo_pago:o.metodo_pago_abono_botiquin||null};await _(e)}if(i.abono==="SI"){Array.isArray(i.abonos)||(i.abonos=[]),i.abonos.push({cantidad:o.cantidad_abono_coach,fecha:o.fecha_abono_coach,metodo:o.metodo_pago_abono_coach}),i.total_abonado=parseFloat(o.cantidad_abono_coach)+parseFloat(i.total_abonado||0),i.abono="NO";const e={jugadorId:o.jugadorId,nombre:o.nombre,tabla:"Jugador",concepto:"Pago de coach (abono)",fecha_pago:o.fecha_abono_coach||g,total:o.cantidad_abono_coach||0,metodo_pago:o.metodo_pago_abono_coach||null};await _(e)}const l={...o,pagos:o.pagos.map(e=>({...e}))},g=b().format("YYYY-MM-DD");if(n.estatus==="pagado"){const e={jugadorId:l.jugadorId,nombre:l.nombre,tabla:"Jugador",concepto:"Pago de inscripción",fecha_pago:n.fecha_pago||g,total:n.monto||0,metodo_pago:n.metodo_pago||null};await _(e)}if(t.estatus==="pagado"){const e={jugadorId:l.jugadorId,nombre:l.nombre,tabla:"Jugador",concepto:"Pago de túnel",fecha_pago:t.estatus.fecha_pago||g,total:t.estatus.monto||0,metodo_pago:t.estatus.metodo_pago||null};await _(e)}if(r.estatus==="pagado"){const e={jugadorId:l.jugadorId,nombre:l.nombre,tabla:"Jugador",concepto:"Pago de botiquín",fecha_pago:r.fecha_pago||g,total:r.monto||0,metodo_pago:r.metodo_pago||null};await _(e)}if(i.estatus==="pagado"){const e={jugadorId:l.jugadorId,nombre:l.nombre,tabla:"Jugador",concepto:"Pago de coaching semanal",fecha_pago:i.fecha_pago||g,total:i.monto||0,metodo_pago:i.metodo_pago||null};await _(e)}delete a.jugador,delete a.botiquin,delete a.coacheo,delete a.inscripcion,delete a.prorroga,delete a.tunel,delete a.fecha_limite,delete a.cantidad_abono_ins,delete a.fecha_abono_ins,delete a.metodo_pago_abono_ins,delete a.cantidad_abono_coach,delete a.fecha_abono_coach,delete a.metodo_pago_abono_coach,delete a.cantidad_abono_tunel,delete a.fecha_abono_tunel,delete a.metodo_pago_abono_tunel,delete a.cantidad_abono_botiquin,delete a.fecha_abono_botiquin,delete a.metodo_pago_abono_botiquin;const p=h(m,"pagos_jugadores",d);await Y(p,a)}catch(a){console.error("Error al actualizar pago:",a)}},J=async d=>{try{const o=h(m,"pagos_jugadores",d);await w(o)}catch(o){console.error("Error al eliminar pago:",o)}};let f=null;const R=F((d,o)=>({payments:[],loading:!1,getDataPaymentsPlayer:async()=>(d({loading:!0}),new Promise((a,c)=>{try{f?a(o().payments):f=C(n=>{d({payments:n}),a(n)})}catch(n){console.error(n),c(n)}finally{d({loading:!1})}})),addPayment:async a=>{const c=async()=>{try{const t=b().add(1,"week").format("YYYY/MM/DD");a.pagos[0].fecha_limite=t,a.jugadorId=a.jugador.value,a.nombre=a.jugador.label,delete a.jugador,await A(a)}catch(n){console.error(n)}};u.promise(c(),{loading:"Creando registro...",success:"Registro creado correctamente",error:"Falló al crear el registro."})},editPayment:async a=>{const c=async()=>{try{await M(a.id,a)}catch(n){console.error(n)}};u.promise(c(),{loading:"Actualizando...",success:"Actualizado correctamente",error:"Falló al eliminar."})},deletePayment:async a=>{const c=async()=>{try{await J(a)}catch(n){console.error(n)}};u.promise(c(),{loading:"Eliminando...",success:"Eliminado correctamente",error:"Falló al eliminar."})}}));export{R as u};
